import * as THREE from 'three';
import gsap from 'gsap';

// --- Configuration ---
const CONFIG = {
  particleCount: 2000,
  particleSize: 0.02,
  color1: 0x00f3ff, // Cyan
  color2: 0xbc13fe, // Purple
};

// --- Scene Setup ---
const canvas = document.querySelector('#bg-canvas');
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x050505, 0.002); // Fog for depth

const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({
  canvas: canvas,
  antialias: true,
  alpha: true
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

// --- Objects ---
// Create a particle system
const particlesGeometry = new THREE.BufferGeometry();
const posArray = new Float32Array(CONFIG.particleCount * 3);
const colorsArray = new Float32Array(CONFIG.particleCount * 3);

const color1 = new THREE.Color(CONFIG.color1);
const color2 = new THREE.Color(CONFIG.color2);

for (let i = 0; i < CONFIG.particleCount * 3; i += 3) {
  // Position
  posArray[i] = (Math.random() - 0.5) * 15;     // x
  posArray[i + 1] = (Math.random() - 0.5) * 15;   // y
  posArray[i + 2] = (Math.random() - 0.5) * 15;   // z

  // Color mix
  const mixedColor = color1.clone().lerp(color2, Math.random());
  colorsArray[i] = mixedColor.r;
  colorsArray[i + 1] = mixedColor.g;
  colorsArray[i + 2] = mixedColor.b;
}

particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));

const particlesMaterial = new THREE.PointsMaterial({
  size: CONFIG.particleSize,
  vertexColors: true,
  transparent: true,
  opacity: 0.8,
  blending: THREE.AdditiveBlending
});

const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
scene.add(particlesMesh);

// Create a geometric shape in the center (Icosahedron)
const geoGeometry = new THREE.IcosahedronGeometry(1, 1);
const geoMaterial = new THREE.MeshBasicMaterial({
  color: CONFIG.color1,
  wireframe: true,
  transparent: true,
  opacity: 0.3
});
const geoMesh = new THREE.Mesh(geoGeometry, geoMaterial);
scene.add(geoMesh);

// Add some lights (though BasicMaterial doesn't need them, good for future expansion)
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);

const pointLight = new THREE.PointLight(CONFIG.color2, 1);
pointLight.position.set(2, 3, 4);
scene.add(pointLight);


// --- Animation Loop ---
const clock = new THREE.Clock();
let mouseX = 0;
let mouseY = 0;

// Mouse interaction
window.addEventListener('mousemove', (event) => {
  mouseX = event.clientX / window.innerWidth - 0.5;
  mouseY = event.clientY / window.innerHeight - 0.5;
});

function animate() {
  const elapsedTime = clock.getElapsedTime();

  // Rotate entire particle system slowly
  particlesMesh.rotation.y = elapsedTime * 0.05;
  particlesMesh.rotation.x = elapsedTime * 0.02;

  // Interactive rotation based on mouse
  particlesMesh.rotation.y += mouseX * 0.05;
  particlesMesh.rotation.x += mouseY * 0.05;

  // Rotate central geometry
  geoMesh.rotation.x = elapsedTime * 0.2;
  geoMesh.rotation.y = elapsedTime * 0.1;

  // Pulse effect for geometry
  const scale = 1 + Math.sin(elapsedTime * 2) * 0.1;
  geoMesh.scale.set(scale, scale, scale);

  // Wave effect for particles (advanced)
  // We could update positions here but for performance let's keep it simple first

  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}

animate();

// --- Resize Handling ---
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
});

// --- GSAP UI Animations ---
const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

tl.from(".hero", {
  y: -50,
  opacity: 0,
  duration: 1.5,
  delay: 0.5
})
  .from(".glitch", {
    scale: 0.9,
    opacity: 0,
    duration: 1
  }, "-=1")
  .from(".subtitle", {
    y: 20,
    opacity: 0,
    duration: 1
  }, "-=0.8")
  .to(".project-card", {
    y: 0,
    opacity: 1,
    duration: 0.8,
    stagger: 0.2
  }, "-=0.5")
  .from(".footer", {
    y: 20,
    opacity: 0,
    duration: 1
  }, "-=0.5");
